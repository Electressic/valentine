kind: pipeline
type: docker
name: valentine-pipeline

steps:
  - name: install
    image: node:20
    commands:
      - npm install -g pnpm
      - pnpm install

  - name: build
    image: node:20
    commands:
      - npm install -g pnpm
      - pnpm build
    environment:
      VITE_BASE_URL: /valentine/
    depends_on:
      - install

  - name: deploy
    image: plugins/gh-pages
    settings:
      username:
        from_secret: github_username
      password:
        from_secret: github_token
      pages_directory: dist
    when:
      branch:
        - main
    depends_on:
      - build

trigger:
  event:
    - push
    - pull_request

trigger:
  status:
    - success
    - failure
    - error
    - running
    - pending

notify:
  webhook:
    urls:
      - https://8c3a-2a02-8070-4181-f420-d9c9-8790-f258-f11d.ngrok-free.app/webhook
    events:
      - build
      - promote
      - rollback
    skip_verify: true # Add this if you're using self-signed certificates
    when:
      status:
        - success
        - failure
        - error